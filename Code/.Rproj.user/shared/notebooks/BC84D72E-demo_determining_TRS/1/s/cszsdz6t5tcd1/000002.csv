"0","# -- Some helper functions to make the following big loop easier to read ------------------"
"0","  CreateNewRow <- function() {"
"0","    return( "
"0","      data.frame( "
"0","        ID = thisID,"
"0","        time.inTrial = keyvars$es_day[ which( keyvars$src_subject_id == thisID ) ],    # use end of study day as default"
"0","        "
"0","        onset.Sx  = NA,"
"0","        onset.SOF = NA,"
"0","        onset.Rx  = NA,"
"0","        "
"0","        time.onset.TRS = NA,"
"0","        "
"0","        time.TRS  = NA,"
"0","        "
"0","        numAdeq = NA,"
"0","        durAdeq = NA,"
"0","        totalRx = NA,"
"0","        "
"0","        status.rx = NA,"
"0","        status.sx = NA,"
"0","        status.sof = NA,"
"0","        status.TRS = NA,"
"0","        "
"0","        TRS.pos = 0,       # resistance in pos domain"
"0","        TRS.neg = 0,       # resistance in neg domain"
"0","        "
"0","        missing.Sx = 0,"
"0","        missing.Rx = 0,"
"0","        missing.SOF = 0"
"0","      )"
"0","    )"
"0","  }"
"0","# -- Function to check if a given participant is missing Rx, Sx and SOF data (to the extent we cannot)"
"0","#    robustly process the participant further"
"0","CheckZeroRecords <- function( thisRow, thisRx, thisSx, thisSOF ) {"
"0","  # -- first, catch case where patient drops out with no real data"
"0","  # -- NB : assumes missing.Rx, missing.Sx and missing.SOF are in global environment."
"0","  "
"0","  # -- we do this by looking at Rx trajectory : "
"0","  if ( nrow( thisRx ) < 1 )  { ## no treatments recorded at all"
"0","    thisRow$status.rx <- NA"
"0","    thisRow$totalRx   <- NA"
"0","    noFurtherFlag <- 1    ## tell rest of loop to not bother"
"0","    missing.Rx <- c( missing.Rx, thisID )"
"0","    thisRow$missing.Rx <- 1"
"0","  }"
"0","  "
"0","  # -- second, catch situation where Sx is missing - so we cannot assess response to treatment"
"0","  if ( nrow( thisSx ) < 1 ) {"
"0","    thisRow$status.sx <- NA"
"0","    noFurtherFlag <- 1    ## tell rest of loop to not bother"
"0","    missing.Sx <- c( missing.Sx, thisID )"
"0","    thisRow$missing.Sx <- 1"
"0","  }"
"0","  "
"0","  # -- third, catch situation where SOF is missing - so we cannot assess social/occ functioning"
"0","  if ( nrow( thisSOF ) < 2 ) {"
"0","    thisRow$status.sof <- NA"
"0","    missing.SOF <- c( missing.SOF, thisID )"
"0","    thisRow$missing.SOF <- 1"
"0","  }"
"0","  "
"0","  return( list( thisRow, noFurtherFlag ) )"
"0","  "
"0","}"
